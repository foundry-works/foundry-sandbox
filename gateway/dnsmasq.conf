# Automatically generated dnsmasq configuration
# Generated from: /home/tyler/GitHub/foundry-sandbox/gateway/allowlist.conf
# DO NOT EDIT MANUALLY - use build-configs.sh to regenerate
# Generated: Tue 03 Feb 2026 08:01:59 AM EST
#
# SECURITY: This config implements DNS-based egress filtering.
# All domains are blocked by default, only allowlisted domains resolve.
#

# Privilege dropping: run as appuser after binding port 53
user=appuser
group=appuser

# Log DNS queries for security auditing
log-queries
log-facility=/dev/stdout

# ============================================================================
# BLOCK ALL DOMAINS BY DEFAULT
# ============================================================================
# no-resolv: Don't read /etc/resolv.conf - prevents fallback to upstream DNS
# address=/#/: Returns NXDOMAIN for any domain not explicitly allowed
# Together these ensure ONLY allowlisted domains can resolve.
no-resolv
address=/#/

# ============================================================================
# ALLOWLISTED DOMAINS
# ============================================================================
# These domains are forwarded to Docker's internal DNS (127.0.0.11) for resolution.
# Format: server=/<domain>/127.0.0.11 forwards to Docker DNS

server=/github.com/127.0.0.11
server=/api.github.com/127.0.0.11
server=/uploads.github.com/127.0.0.11
server=/raw.githubusercontent.com/127.0.0.11
server=/objects.githubusercontent.com/127.0.0.11
server=/codeload.github.com/127.0.0.11
server=/gist.github.com/127.0.0.11
server=/gist.api.github.com/127.0.0.11
server=/gist.githubusercontent.com/127.0.0.11
server=/api.anthropic.com/127.0.0.11
server=/console.anthropic.com/127.0.0.11
server=/claude.ai/127.0.0.11
server=/generativelanguage.googleapis.com/127.0.0.11
server=/cloudcode-pa.googleapis.com/127.0.0.11
server=/accounts.google.com/127.0.0.11
server=/oauth2.googleapis.com/127.0.0.11
server=/api.z.ai/127.0.0.11
server=/open.bigmodel.cn/127.0.0.11
server=/opencode.ai/127.0.0.11
server=/opncd.ai/127.0.0.11
server=/api.tavily.com/127.0.0.11
server=/api.perplexity.ai/127.0.0.11
server=/api.semanticscholar.org/127.0.0.11
server=/pypi.org/127.0.0.11
server=/files.pythonhosted.org/127.0.0.11

# ============================================================================
# WILDCARD DOMAINS
# ============================================================================
# These patterns allow all subdomains (e.g., *.openai.com allows api.openai.com)

server=/openai.com/127.0.0.11
server=/chatgpt.com/127.0.0.11

# Total allowlisted domains: 27

