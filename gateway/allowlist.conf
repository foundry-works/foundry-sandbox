# Domain Allowlist for Credential Isolation Gateway
# Single source of truth for egress proxy and limited-mode firewall allowlists
#
# Format: domain [type]
#
# Syntax options:
#   domain.com [type]     - Exact domain match
#   *.domain.com [type]   - Wildcard: matches all subdomains (foo.domain.com, a.b.domain.com)
#                           Also matches the base domain itself (domain.com)
#   !domain.com           - Block DoH (DNS over HTTPS) endpoints (not yet implemented)
#
# Wildcard behavior:
#   - *.example.com matches: foo.example.com, bar.baz.example.com, example.com
#   - *.example.com does NOT match: notexample.com, exampleXcom
#   - Wildcards enable "wildcard mode" in the firewall (opens ports 80/443)
#   - Security is maintained via DNS filtering and gateway hostname validation

# ============================================================================
# GITHUB INFRASTRUCTURE
# ============================================================================
# Primary GitHub services
github.com github
api.github.com github
uploads.github.com github
raw.githubusercontent.com github
objects.githubusercontent.com github
codeload.github.com github
gist.github.com github
gist.api.github.com github
gist.githubusercontent.com github

# ============================================================================
# AI PROVIDER APIs
# ============================================================================
# Anthropic (Claude)
api.anthropic.com ai
console.anthropic.com ai
claude.ai ai

# OpenAI (ChatGPT, GPT-4, Codex) - wildcards for all subdomains
*.openai.com ai
*.chatgpt.com ai

# Google (Gemini, oauth for Gemini CLI)
generativelanguage.googleapis.com ai
cloudcode-pa.googleapis.com ai
accounts.google.com oauth
oauth2.googleapis.com oauth

# Z.AI / Zhipu (GLM models)
api.z.ai ai
open.bigmodel.cn ai

# ============================================================================
# AI CODING TOOLS
# ============================================================================
# OpenCode CLI domains (different TLDs, not covered by wildcards)
opencode.ai ai-tool
opncd.ai ai-tool

# ============================================================================
# RESEARCH AND KNOWLEDGE APIS
# ============================================================================
# Deep research providers (content extraction handled server-side)
api.tavily.com research
api.perplexity.ai research
api.semanticscholar.org research

# ============================================================================
# DNS HANDLING REQUIREMENTS
# ============================================================================
# DNS queries are restricted to resolvers in /etc/resolv.conf or Docker gateway
# Limited mode firewall dynamically discovers allowed DNS servers:
# - Parses /etc/resolv.conf for nameserver entries
# - Handles Docker Desktop format: host(192.168.65.7) -> 192.168.65.7
# - Extracts upstream servers from ExtServers field in resolv.conf
# - Falls back to Docker gateway if only loopback DNS available
# - Blocks all other DNS queries on ports 53 (TCP/UDP)
#
# NOTE: DoH endpoints can be optionally blocked with ! prefix (not implemented yet)
# Examples of blocked DoH endpoints (for future enhancement):
# !dns.cloudflare.com
# !dns.google
# !dns.quad9.net

# ============================================================================
# PACKAGE REPOSITORIES
# ============================================================================
# PyPI (Python Package Index)
# NOTE: These are allowed through DNS/proxy but blocked at sandbox level
# via iptables after pip install completes. See block_pypi_after_install()
pypi.org package
files.pythonhosted.org package

# ============================================================================
# KNOWN IPs (non-DNS resolved)
# ============================================================================
# (No hardcoded IPs currently needed)
