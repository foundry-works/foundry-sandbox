# Domain Allowlist for Credential Isolation Gateway
# Single source of truth for egress proxy and limited-mode firewall allowlists
#
# Format: domain [type]
#
# Syntax options:
#   domain.com [type]     - Exact domain match
#   *.domain.com [type]   - Wildcard: matches all subdomains (foo.domain.com, a.b.domain.com)
#                           Also matches the base domain itself (domain.com)
#   !domain.com           - Block DoH (DNS over HTTPS) endpoints (not yet implemented)
#
# Wildcard behavior:
#   - *.example.com matches: foo.example.com, bar.baz.example.com, example.com
#   - *.example.com does NOT match: notexample.com, exampleXcom
#   - Wildcards enable "wildcard mode" in the firewall (opens ports 80/443)
#   - Security is maintained via DNS filtering and gateway hostname validation

# ============================================================================
# GITHUB INFRASTRUCTURE
# ============================================================================
# Primary GitHub services
github.com github
api.github.com github
raw.githubusercontent.com github
objects.githubusercontent.com github
codeload.github.com github
gist.github.com github
gist.api.github.com github
gist.githubusercontent.com github

# GitHub Enterprise (uncomment and configure as needed)
# github.mycompany.com github
# api.github.mycompany.com github

# GitHub CIDR allowlists (referenced for firewall generation)
# Source: https://api.github.com/meta
# 140.82.112.0/20    (Primary GitHub servers)
# 192.30.252.0/22    (Legacy GitHub)
# 185.199.108.0/22   (GitHub Pages / raw content)
# 143.55.64.0/20     (Additional infrastructure)

# ============================================================================
# PACKAGE REGISTRIES
# ============================================================================
# NPM/Node.js ecosystem
registry.npmjs.org npm

# Python Package Index
pypi.org pypi
files.pythonhosted.org pypi

# Go modules
proxy.golang.org go
sum.golang.org go

# Rust/Cargo ecosystem
crates.io cargo
static.crates.io cargo

# ============================================================================
# CDN AND CONTENT DELIVERY
# ============================================================================
# Cloudflare (used as proxy by Cursor and others)
# CIDR allowlists referenced for firewall generation:
# 173.245.48.0/20
# 103.21.244.0/22
# 103.22.200.0/22
# 103.31.4.0/22
# 141.101.64.0/18
# 108.162.192.0/18
# 190.93.240.0/20
# 188.114.96.0/20
# 197.234.240.0/22
# 198.41.128.0/17
# 162.158.0.0/15
# 104.16.0.0/13
# 104.24.0.0/14
# 172.64.0.0/13
# 131.0.72.0/22
# Source: https://www.cloudflare.com/ips-v4

# CloudFront (AWS CDN)
# Wildcard for CloudFront domains
*.cloudfront.net cdn

# Fastly CDN
*.fastly.net cdn

# Docker Hub CDN
production.cloudflare.docker.com cdn

# ============================================================================
# AI PROVIDER APIs
# ============================================================================
# Anthropic (Claude)
api.anthropic.com ai
console.anthropic.com ai
claude.ai ai

# OpenAI (ChatGPT, GPT-4, Codex) - wildcards for all subdomains
*.openai.com ai
*.chatgpt.com ai

# Google (Gemini, oauth for Gemini CLI)
generativelanguage.googleapis.com ai
cloudcode-pa.googleapis.com ai
accounts.google.com oauth
oauth2.googleapis.com oauth

# Z.AI / Zhipu (GLM models)
api.z.ai ai
open.bigmodel.cn ai

# ============================================================================
# AI CODING TOOLS
# ============================================================================
# Cursor - wildcard domains for main services and API servers
*.cursor.com ai-tool
*.cursor.sh ai-tool

# Cursor-related domains (different TLDs, not covered by wildcards)
marketplace.cursorapi.com ai-tool
cursor-cdn.com cdn
download.todesktop.com cdn
opencode.ai ai-tool
opncd.ai ai-tool
models.dev ai-tool

# GitHub Copilot API
api.githubcopilot.com ai-tool

# ============================================================================
# RESEARCH AND KNOWLEDGE APIS
# ============================================================================
# Deep research providers (content extraction handled server-side)
api.tavily.com research
api.perplexity.ai research
api.semanticscholar.org research
www.googleapis.com research

# ============================================================================
# DOCKER REGISTRY
# ============================================================================
registry-1.docker.io container
auth.docker.io container

# ============================================================================
# DNS HANDLING REQUIREMENTS
# ============================================================================
# DNS queries are restricted to resolvers in /etc/resolv.conf or Docker gateway
# Limited mode firewall dynamically discovers allowed DNS servers:
# - Parses /etc/resolv.conf for nameserver entries
# - Handles Docker Desktop format: host(192.168.65.7) -> 192.168.65.7
# - Extracts upstream servers from ExtServers field in resolv.conf
# - Falls back to Docker gateway if only loopback DNS available
# - Blocks all other DNS queries on ports 53 (TCP/UDP)
#
# NOTE: DoH endpoints can be optionally blocked with ! prefix (not implemented yet)
# Examples of blocked DoH endpoints (for future enhancement):
# !dns.cloudflare.com
# !dns.google
# !dns.quad9.net

# ============================================================================
# KNOWN IPs (non-DNS resolved)
# ============================================================================
# Cursor Agent backends (AWS us-east-1, hardcoded in agent binary)
# 44.197.141.31   (api5.cursor.sh)
# 184.73.249.78   (api2.cursor.sh)

# ============================================================================
# ROTATING DOMAINS (now handled by wildcards)
# ============================================================================
# The *.cursor.sh wildcard now covers all Cursor API servers including those
# with rotating IPs. In wildcard mode, DNS filtering handles access control
# rather than IP-based firewall rules.
