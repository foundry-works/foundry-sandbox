# Domain allowlist for unified proxy
# Supports exact matches and wildcard patterns (*.domain.com)

version: "1.0"

domains:
  # GitHub
  - github.com
  - "*.github.com"
  - api.github.com
  - raw.githubusercontent.com
  - objects.githubusercontent.com
  - codeload.github.com
  - github-releases.githubusercontent.com
  - gist.github.com
  - gist.githubusercontent.com
  - release-assets.githubusercontent.com
  - codeload.githubusercontent.com
  - uploads.github.com

  # AI Providers
  - api.anthropic.com
  - api.openai.com
  - "*.api.openai.com"
  - chatgpt.com
  - "*.chatgpt.com"
  - generativelanguage.googleapis.com
  - accounts.google.com
  - oauth2.googleapis.com
  - "*.googleapis.com"
  - auth.openai.com
  - api.tavily.com
  - api.perplexity.ai
  - api.z.ai
  - open.bigmodel.cn
  - api.semanticscholar.org

  # Python Package Repository
  - pypi.org
  - "*.pypi.org"
  - files.pythonhosted.org

  # Node.js Package Repository
  - npmjs.org
  - registry.npmjs.org

  # Ruby Package Repository
  - rubygems.org
  - "*.rubygems.org"

  # Rust Package Repository
  - crates.io
  - "*.crates.io"

  # Go Package Repository
  - pkg.go.dev
  - proxy.golang.org
  - sum.golang.org

  # Java Package Repository
  - maven.apache.org
  - repo1.maven.org

  # PHP Package Repository
  - packagist.org
  - repo.packagist.org

# HTTP endpoint allowlist for fine-grained API access control
# Each endpoint specifies host, allowed methods, and allowed paths
http_endpoints:
  # GitHub API - segment-safe path patterns
  # *  matches exactly one path segment (does not span /)
  # ** matches one or more characters and may span /
  - host: api.github.com
    methods: [GET, POST, PUT, PATCH, DELETE]
    paths:
      # Repository root (owner/repo metadata)
      - "/repos/*/*"
      # Pull requests
      - "/repos/*/*/pulls"
      - "/repos/*/*/pulls/*"
      # Issues
      - "/repos/*/*/issues"
      - "/repos/*/*/issues/*"
      # Issue comments
      - "/repos/*/*/issues/*/comments"
      - "/repos/*/*/issues/*/comments/*"
      - "/repos/*/*/issues/comments"
      - "/repos/*/*/issues/comments/*"
      # Git data (refs, trees, blobs, commits)
      - "/repos/*/*/git/**"
      # Branches
      - "/repos/*/*/branches"
      - "/repos/*/*/branches/**"
      # Commits
      - "/repos/*/*/commits"
      - "/repos/*/*/commits/*"
      # File contents
      - "/repos/*/*/contents"
      - "/repos/*/*/contents/**"
      # Compare
      - "/repos/*/*/compare/**"
      # Releases
      - "/repos/*/*/releases"
      - "/repos/*/*/releases/*"
      # Tags
      - "/repos/*/*/tags"
      # Collaborators
      - "/repos/*/*/collaborators"
      - "/repos/*/*/collaborators/*"
      # Comments (PR/issue comments)
      - "/repos/*/*/comments"
      - "/repos/*/*/comments/*"
      # Pull request review comments
      - "/repos/*/*/pulls/*/comments"
      - "/repos/*/*/pulls/*/comments/*"
      - "/repos/*/*/pulls/comments"
      - "/repos/*/*/pulls/comments/*"
      # Pull request reviews
      - "/repos/*/*/pulls/*/reviews"
      - "/repos/*/*/pulls/*/reviews/*"
      - "/repos/*/*/pulls/*/reviews/**"
      # Commit statuses
      - "/repos/*/*/statuses/*"
      # Check runs / check suites
      - "/repos/*/*/check-runs"
      - "/repos/*/*/check-runs/*"
      # Labels
      - "/repos/*/*/labels"
      - "/repos/*/*/labels/**"
      # Milestones
      - "/repos/*/*/milestones"
      - "/repos/*/*/milestones/*"
      # Non-repo endpoints
      - "/user/*"
      - "/users/*"
      - "/orgs/*"
      - "/gists/*"
      - "/search/*"
      - "/rate_limit"

  # Anthropic API
  - host: api.anthropic.com
    methods: [GET, POST]
    paths:
      - "/v1/messages"
      - "/v1/complete"
      - "/api/oauth/profile"

  # OpenAI API
  - host: api.openai.com
    methods: [POST, GET]
    paths:
      - "/v1/chat/completions"
      - "/v1/completions"
      - "/v1/models"
      - "/v1/responses"

  # ChatGPT / Codex
  - host: chatgpt.com
    methods: [POST, GET]
    paths:
      - "/backend-api/codex/**"
      - "/backend-api/**"

  # Google AI API
  - host: generativelanguage.googleapis.com
    methods: [POST, GET]
    paths:
      - "/v1beta/models/*"
      - "/v1/models/*"

  # Google Auth (for Gemini login)
  - host: accounts.google.com
    methods: [GET, POST]
    paths:
      - "/o/oauth2/*"
      - "/token"
  - host: oauth2.googleapis.com
    methods: [POST, GET]
    paths:
      - "/token"
      - "/tokeninfo"
      - "/v1/*"

  # Tavily API
  - host: api.tavily.com
    methods: [POST, GET]
    paths:
      - "/search"
      - "/extract"
      - "/*"

  # Perplexity API
  - host: api.perplexity.ai
    methods: [POST, GET]
    paths:
      - "/chat/completions"
      - "/*"

  # Codex OAuth
  - host: auth.openai.com
    methods: [POST]
    paths:
      - "/oauth/token"

  # GitHub uploads (release assets)
  - host: uploads.github.com
    methods: [POST, PUT, PATCH]
    paths:
      - "/repos/*/*/releases/*/assets"

  # Zhipu AI (OpenCode + claude-zai)
  # Uses multi-segment paths: /api/paas/v4/... and /api/anthropic/v1/...
  - host: open.bigmodel.cn
    methods: [POST, GET]
    paths:
      - "/**"
  - host: api.z.ai
    methods: [POST, GET]
    paths:
      - "/**"

  # Semantic Scholar
  - host: api.semanticscholar.org
    methods: [GET]
    paths:
      - "/*"

# Blocked API paths - dangerous endpoints that must never be accessed
# Uses segment-aware matching:
# - *  matches exactly one path segment (not spanning /)
# - ** matches one or more characters and may span /
blocked_paths:
  - host: api.github.com
    patterns:
      # Webhooks - could exfiltrate data to attacker-controlled servers
      - "/repos/*/*/hooks"
      - "/repos/*/*/hooks/*"
      # SSH deploy keys - could grant persistent repo access
      - "/repos/*/*/keys"
      - "/repos/*/*/keys/*"
      # Deploy keys (alternate endpoint)
      - "/repos/*/*/deploy_keys"
      - "/repos/*/*/deploy_keys/*"
      # Environment deployment branch policy - could weaken protections
      - "/repos/*/*/environments/*/deployment-branch-policy"
      # Actions secrets - could expose or modify CI/CD secrets
      - "/repos/*/*/actions/secrets"
      - "/repos/*/*/actions/secrets/*"
      # Actions variables - could modify CI/CD configuration
      - "/repos/*/*/actions/variables"
      - "/repos/*/*/actions/variables/*"
      # Branch admin operations - could weaken branch protections
      - "/repos/*/*/branches/**/protection"
      - "/repos/*/*/branches/**/protection/**"
      - "/repos/*/*/branches/**/rename"
