# Strict allowlist - only these commands are permitted via sudo
# No PASSWD:ALL fallback - unlisted commands are denied

# Package management (safe)
ubuntu ALL=(ALL) NOPASSWD: /usr/bin/apt-get update
ubuntu ALL=(ALL) NOPASSWD: /usr/bin/apt-get install *

# Service management (safe)
ubuntu ALL=(ALL) NOPASSWD: /usr/sbin/service * start
ubuntu ALL=(ALL) NOPASSWD: /usr/sbin/service * stop
ubuntu ALL=(ALL) NOPASSWD: /usr/sbin/service * restart
ubuntu ALL=(ALL) NOPASSWD: /usr/sbin/service * status

# Fix ownership of directories created by Docker mounts (credential isolation mode)
# Limited to home directory for safety
ubuntu ALL=(ALL) NOPASSWD: /usr/bin/chown -R * /home/ubuntu/.*
ubuntu ALL=(ALL) NOPASSWD: /usr/bin/chown * /home/ubuntu/.*

# Network mode switching
# Preserve environment variables needed for credential isolation
Defaults!/usr/local/bin/network-firewall.sh env_keep += "SANDBOX_CREDENTIAL_PROXY SANDBOX_NETWORK_MODE SANDBOX_DEBUG"
Defaults!/usr/local/bin/network-mode env_keep += "SANDBOX_CREDENTIAL_PROXY SANDBOX_NETWORK_MODE SANDBOX_DEBUG"
ubuntu ALL=(ALL) NOPASSWD: /usr/local/bin/network-firewall.sh
ubuntu ALL=(ALL) NOPASSWD: /usr/local/bin/network-mode *

# Add other safe commands as needed:
# ubuntu ALL=(ALL) NOPASSWD: /usr/bin/npm *
# ubuntu ALL=(ALL) NOPASSWD: /usr/bin/pip *

# NO fallback line - everything else is denied
