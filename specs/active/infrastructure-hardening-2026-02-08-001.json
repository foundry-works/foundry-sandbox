{
  "spec_id": "infrastructure-hardening-2026-02-08-001",
  "title": "infrastructure-hardening",
  "generated": "2026-02-08T21:54:35.734825Z",
  "last_updated": "2026-02-08T22:32:31.717733Z",
  "metadata": {
    "description": "",
    "mission": "Close remaining infrastructure hardening gaps: harden git hook prevention on proxy side, block self-merge vectors at both API filter and policy engine layers, restore read-only filesystem in credential isolation mode, and block workflow file pushes via pack data inspection.",
    "objectives": [],
    "complexity": "low",
    "estimated_hours": 0,
    "assumptions": [
      "All changes build on tylerburleigh/foundry-sandbox-20260206-1024 branch. Check for merge conflicts with main before starting.",
      "mitmproxy default synchronous addon execution model (no @concurrent decorator). If concurrent execution is enabled, _check_restricted_paths() must be wrapped in a threading.Lock.",
      "Existing running sandboxes are not affected - they use compose config from creation time. New sandboxes get hardened config automatically.",
      "GitHub uses SHA-1 for object hashing. GIT_EMPTY_TREE_SHA = 4b825dc642cb6eb9a060e54bf899d69f82623700. If GitHub adopts SHA-256, the empty tree hash check will fail closed (wrong hash -> nonzero exit -> push blocked).",
      "tests/unit/conftest.py already pre-mocks mitmproxy modules in sys.modules. New test files (test_github_api_filter.py, test_dual_layer_consistency.py) can use this infrastructure.",
      "Full implementation details (exact code changes, design rationale, error message policy, rollback procedures) are in PLAN1.md. The spec references it as the authoritative source for implementation specifics."
    ],
    "owner": "",
    "category": "implementation",
    "template": "empty"
  },
  "progress_percentage": 47,
  "status": "in_progress",
  "current_phase": "phase-3",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "infrastructure-hardening",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 36,
      "completed_tasks": 17,
      "metadata": {
        "purpose": "",
        "category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Git Hook Hardening",
      "status": "completed",
      "parent": "spec-root",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5",
        "verify-1-1",
        "task-1-6"
      ],
      "total_tasks": 7,
      "completed_tasks": 7,
      "metadata": {
        "purpose": "",
        "description": "Prevent proxy-side git execution from triggering malicious hooks in cloned repos. Lowest risk change - two config flags added to command construction. Corresponds to PLAN1.md Item 3.",
        "needs_journaling": true,
        "completed_at": "2026-02-08T22:12:11.765354Z"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Inject hook-disabling flags in execute_git()",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "At line 1803 where cmd = [GIT_BINARY] + translated_args, prepend -c core.hooksPath=/dev/null and -c core.fsmonitor=false before translated_args. core.hooksPath=/dev/null disables all git hooks. core.fsmonitor=false disables the filesystem monitor which can execute arbitrary commands. Placement before translated_args is safe because CONFIG_NEVER_ALLOW already blocks the client from sending either config key. See PLAN1.md Item 3 for full rationale.",
        "file_path": "unified-proxy/git_operations.py",
        "acceptance_criteria": [
          "execute_git() command array includes -c core.hooksPath=/dev/null before translated_args",
          "execute_git() command array includes -c core.fsmonitor=false before translated_args",
          "No existing tests broken by the change"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:05:03.597987Z",
        "completed_at": "2026-02-08T22:05:34.619097Z",
        "needs_journaling": false,
        "actual_hours": 0.01,
        "journaled_at": "2026-02-08T22:05:34.619175Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Add unit test test_proxy_side_hooks_disabled",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Verify that execute_git() produces a command line containing both -c core.hooksPath=/dev/null and -c core.fsmonitor=false flags.",
        "file_path": "tests/unit/test_git_operations.py",
        "acceptance_criteria": [
          "Test verifies -c core.hooksPath=/dev/null is in the command",
          "Test verifies -c core.fsmonitor=false is in the command",
          "Test passes"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:06:00.506709Z",
        "completed_at": "2026-02-08T22:08:36.515238Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:08:36.515312Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Add unit test test_client_cannot_override_hooks_path",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Verify that client-supplied --config core.hooksPath=/tmp/evil or -c core.hooksPath=/tmp/evil is rejected by CONFIG_NEVER_ALLOW validation (returns a validation error, not silently overriding the injected flag).",
        "file_path": "tests/unit/test_git_operations.py",
        "acceptance_criteria": [
          "Test verifies --config core.hooksPath=... is rejected",
          "Test verifies -c core.hooksPath=... is rejected",
          "Rejection is via CONFIG_NEVER_ALLOW, not silent override"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:06:00.548673Z",
        "completed_at": "2026-02-08T22:08:36.576330Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:08:36.576437Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "Add unit test test_client_cannot_override_fsmonitor",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Verify that client-supplied -c core.fsmonitor=/tmp/evil is rejected by CONFIG_NEVER_ALLOW validation.",
        "file_path": "tests/unit/test_git_operations.py",
        "acceptance_criteria": [
          "Test verifies -c core.fsmonitor=... is rejected by CONFIG_NEVER_ALLOW"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:06:00.591607Z",
        "completed_at": "2026-02-08T22:08:36.632325Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:08:36.632445Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "Add security test test_hooks_disabled_in_execution",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Verify hooks cannot execute during proxy-side git operations. This is an integration-level security test.",
        "file_path": "tests/security/test_git_policy.py",
        "acceptance_criteria": [
          "Test verifies that git hooks in .git/hooks/ are not triggered during proxy-side execution",
          "Test passes"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:06:00.631115Z",
        "completed_at": "2026-02-08T22:08:36.687323Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:08:36.687463Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Verify Phase 1: Git hook hardening",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Run python -m pytest tests/unit/test_git_operations.py tests/security/test_git_policy.py -v and verify all new and existing tests pass.",
        "verification_type": "run-tests",
        "started_at": "2026-02-08T22:08:50.832709Z",
        "completed_at": "2026-02-08T22:09:03.377744Z",
        "needs_journaling": false,
        "actual_hours": 0.0,
        "journaled_at": "2026-02-08T22:09:03.377842Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Self-Merge Prevention API Hardening",
      "status": "completed",
      "parent": "spec-root",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5",
        "task-2-6",
        "task-2-7",
        "task-2-8",
        "verify-2-1",
        "task-2-9"
      ],
      "total_tasks": 10,
      "completed_tasks": 10,
      "metadata": {
        "purpose": "",
        "description": "Close remaining self-merge vectors by blocking auto-merge enablement, review approval (APPROVE only), review deletion, and additional GraphQL mutations. Defense-in-depth: blocked in both github-api-filter.py (first line, pattern matching on method + path) and policy_engine.py (second line, can inspect request bodies). When a new endpoint is blocked, it must be added to both files with cross-reference comments. This is machine-enforced by test_dual_layer_consistency.py. Corresponds to PLAN1.md Item 2a.",
        "needs_journaling": true,
        "completed_at": "2026-02-08T22:32:31.717255Z"
      },
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Add REST blocks to github-api-filter.py BLOCKED_PATTERNS",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add three new entries to BLOCKED_PATTERNS list:\n\n```python\n# Defense-in-depth: also blocked in addons/policy_engine.py\n(\"PUT\", r\"^/repos/[^/]+/[^/]+/pulls/\\d+/auto-merge$\", \"auto-merge: enables automatic merge (requires human approval)\"),\n(\"DELETE\", r\"^/repos/[^/]+/[^/]+/pulls/\\d+/auto-merge$\", \"auto-merge: disables automatic merge (requires human approval)\"),\n(\"DELETE\", r\"^/repos/[^/]+/[^/]+/pulls/\\d+/reviews/\\d+$\", \"review deletion: removes review (requires human approval)\"),\n```\n\nNote: PR review approval is NOT blocked at the path level because comment-only reviews and request-changes reviews are legitimate agent actions. Approval blocking is done via body inspection in the policy engine.",
        "file_path": "unified-proxy/github-api-filter.py",
        "acceptance_criteria": [
          "PUT auto-merge pattern added to BLOCKED_PATTERNS",
          "DELETE auto-merge pattern added to BLOCKED_PATTERNS",
          "DELETE review pattern added to BLOCKED_PATTERNS",
          "Cross-reference comment to policy_engine.py included",
          "PR review POST is NOT blocked at path level (body inspection in policy engine handles APPROVE-only blocking)"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:13:24.661431Z",
        "completed_at": "2026-02-08T22:15:33.473900Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:15:33.473970Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Add GraphQL mutations to ALWAYS_BLOCKED_GRAPHQL_MUTATIONS",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add five new entries to ALWAYS_BLOCKED_GRAPHQL_MUTATIONS:\n\n```python\n\"enablePullRequestAutoMerge\",\n\"disablePullRequestAutoMerge\",\n\"dismissPullRequestReview\",\n\"updatePullRequestBranch\",  # Performs server-side merge; block conservatively\n# addPullRequestReview: blocked entirely because the regex-based mutation parser\n# cannot inspect GraphQL arguments (inline vs variables). APPROVE-only filtering\n# would require a GraphQL AST parser. REST reviews are NOT blocked \u2014 body\n# inspection in policy_engine.py selectively blocks only APPROVE events.\n# Collateral: GraphQL comment/request-changes reviews are blocked. All major\n# tools (gh, hub, Claude) use REST for reviews, so no functional impact.\n\"addPullRequestReview\",\n```\n\nDesign decision: Block addPullRequestReview and updatePullRequestBranch entirely at GraphQL level. The regex-based mutation parser (_check_graphql_mutations() at line 331) only matches mutation names \u2014 it cannot inspect arguments. Selective filtering would require a full GraphQL AST parser, which is out of scope.",
        "file_path": "unified-proxy/github-api-filter.py",
        "acceptance_criteria": [
          "enablePullRequestAutoMerge added to ALWAYS_BLOCKED_GRAPHQL_MUTATIONS",
          "disablePullRequestAutoMerge added",
          "dismissPullRequestReview added",
          "updatePullRequestBranch added with rationale comment",
          "addPullRequestReview added with detailed rationale comment explaining why entire mutation is blocked"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:13:24.716444Z",
        "completed_at": "2026-02-08T22:15:33.543653Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:15:33.543729Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Add auto-merge and review deletion patterns to policy_engine.py",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add new regex patterns and blocking logic:\n\n```python\n# Defense-in-depth: also blocked in github-api-filter.py\nGITHUB_AUTO_MERGE_PATTERN = re.compile(r\"^/repos/[^/]+/[^/]+/pulls/\\d+/auto-merge$\")\nGITHUB_DELETE_REVIEW_PATTERN = re.compile(r\"^/repos/[^/]+/[^/]+/pulls/\\d+/reviews/\\d+$\")\n```\n\nBlock in _check_github_blocklist() alongside existing merge block:\n\n```python\n# Block auto-merge enablement\nif method in (\"PUT\", \"DELETE\") and GITHUB_AUTO_MERGE_PATTERN.match(path):\n    return \"GitHub auto-merge operations are blocked by policy\"\n\n# Block review deletion (prevents removing blocking reviews)\nif method == \"DELETE\" and GITHUB_DELETE_REVIEW_PATTERN.match(path):\n    return \"Deleting pull request reviews is blocked by policy\"\n```",
        "file_path": "unified-proxy/addons/policy_engine.py",
        "acceptance_criteria": [
          "GITHUB_AUTO_MERGE_PATTERN regex added",
          "GITHUB_DELETE_REVIEW_PATTERN regex added",
          "Auto-merge blocked for both PUT and DELETE methods in _check_github_blocklist()",
          "Review deletion blocked for DELETE method in _check_github_blocklist()",
          "Cross-reference comment to github-api-filter.py included"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:13:24.758476Z",
        "completed_at": "2026-02-08T22:15:33.637577Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:15:33.637655Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "Add body inspection for PR review approval in policy_engine.py",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add body inspection for PR review approval in _check_github_body_policies() (around line 465). This follows the same pattern used for state:closed detection (lines 546-552):\n\n```python\n# Defense-in-depth: also blocked at GraphQL level in github-api-filter.py\nGITHUB_PR_REVIEW_PATTERN = re.compile(r\"^/repos/[^/]+/[^/]+/pulls/\\d+/reviews$\")\n\n# In _check_github_body_policies(), add:\nif method == \"POST\" and GITHUB_PR_REVIEW_PATTERN.match(path):\n    event = parsed.get(\"event\")\n    if event is not None and str(event).upper() == \"APPROVE\":\n        return \"Self-approving pull requests is blocked by policy\"\n```\n\nIMPORTANT: This blocks only APPROVE events. COMMENT and REQUEST_CHANGES must remain allowed \u2014 they are legitimate agent actions. The method check must be POST (review creation), not PATCH. The str(event).upper() normalization handles case variations.",
        "file_path": "unified-proxy/addons/policy_engine.py",
        "acceptance_criteria": [
          "GITHUB_PR_REVIEW_PATTERN regex added",
          "Body inspection added to _check_github_body_policies()",
          "Only event=APPROVE is blocked",
          "event=COMMENT is explicitly allowed (not blocked)",
          "event=REQUEST_CHANGES is explicitly allowed (not blocked)",
          "Method check is POST not PATCH",
          "Case-insensitive comparison via str(event).upper()"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:13:24.805441Z",
        "completed_at": "2026-02-08T22:15:33.697932Z",
        "needs_journaling": false,
        "actual_hours": 0.04,
        "journaled_at": "2026-02-08T22:15:33.698029Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "Create tests/unit/test_github_api_filter.py",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Create new test file. Infrastructure needed:\n- Import mitmproxy mocks from conftest.py (already set up in tests/unit/conftest.py \u2014 pre-mocks mitmproxy modules in sys.modules)\n- Use MockHTTPFlow / MockHTTPResponse patterns from existing test files\n- Use pytest fixtures for GitHubAPIFilter instantiation\n\nRequired tests (regression coverage for existing blocks + new blocks):\n- test_blocked_merge_rest \u2014 PUT /repos/.../pulls/.../merge blocked (regression)\n- test_blocked_merge_graphql \u2014 mergePullRequest mutation blocked (regression)\n- test_blocked_auto_merge_graphql \u2014 enablePullRequestAutoMerge mutation blocked\n- test_blocked_disable_auto_merge_graphql \u2014 disablePullRequestAutoMerge mutation blocked\n- test_blocked_add_review_graphql \u2014 addPullRequestReview mutation blocked (all events)\n- test_blocked_dismiss_review_graphql \u2014 dismissPullRequestReview mutation blocked\n- test_blocked_update_branch_graphql \u2014 updatePullRequestBranch mutation blocked\n- test_blocked_auto_merge_rest \u2014 PUT /repos/.../auto-merge blocked\n- test_blocked_delete_auto_merge_rest \u2014 DELETE /repos/.../auto-merge blocked\n- test_blocked_delete_review_rest \u2014 DELETE /repos/.../reviews/123 blocked",
        "file_path": "tests/unit/test_github_api_filter.py",
        "acceptance_criteria": [
          "New file created at tests/unit/test_github_api_filter.py",
          "Uses existing conftest.py mock infrastructure",
          "All 10 test cases implemented and passing",
          "Regression tests for existing merge blocks included",
          "New auto-merge, review, and GraphQL mutation blocks tested"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:16:53.743821Z",
        "completed_at": "2026-02-08T22:21:54.654735Z",
        "actual_hours": 0.08
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-6": {
      "type": "task",
      "title": "Add policy engine unit tests for new blocks",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add tests to existing file (1877 lines, pytest + unittest.mock):\n\n- test_blocked_auto_merge_enable \u2014 PUT auto-merge returns 403\n- test_blocked_auto_merge_disable \u2014 DELETE auto-merge returns 403\n- test_blocked_pr_review_approve \u2014 POST review with {\"event\": \"APPROVE\"} returns 403\n- test_allowed_pr_review_comment \u2014 POST review with {\"event\": \"COMMENT\"} is allowed\n- test_allowed_pr_review_request_changes \u2014 POST review with {\"event\": \"REQUEST_CHANGES\"} is allowed\n- test_blocked_pr_review_deletion \u2014 DELETE review returns 403",
        "file_path": "tests/unit/test_policy_engine.py",
        "acceptance_criteria": [
          "test_blocked_auto_merge_enable passes",
          "test_blocked_auto_merge_disable passes",
          "test_blocked_pr_review_approve passes",
          "test_allowed_pr_review_comment passes (verifies non-APPROVE reviews are NOT blocked)",
          "test_allowed_pr_review_request_changes passes",
          "test_blocked_pr_review_deletion passes"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:16:53.743821Z",
        "completed_at": "2026-02-08T22:21:54.654735Z",
        "actual_hours": 0.08
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-7": {
      "type": "task",
      "title": "Create tests/unit/test_dual_layer_consistency.py",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Create new file enforcing the dual-layer blocking maintenance contract. Define a canonical list of security-critical operations and assert both layers handle each one:\n\n```python\nBLOCKED_OPERATIONS = {\n    \"merge_pr\": {\n        \"api_filter\": (\"PUT\", \"/repos/owner/repo/pulls/1/merge\"),\n        \"policy_engine\": (\"PUT\", \"/repos/owner/repo/pulls/1/merge\"),\n    },\n    \"auto_merge_enable\": {\n        \"api_filter\": (\"PUT\", \"/repos/owner/repo/pulls/1/auto-merge\"),\n        \"policy_engine\": (\"PUT\", \"/repos/owner/repo/pulls/1/auto-merge\"),\n    },\n    # ... one entry per operation ...\n}\n```\n\nFor each operation, send a request through both GitHubAPIFilter and PolicyEngine and assert both block it. Adding a new operation to this dict without implementing it in both layers causes a test failure. This is concrete and refactor-resistant \u2014 it tests behavior, not regex patterns.\n\nPer AI review feedback: include a compatibility matrix documenting intentional asymmetries (e.g., API filter blocks addPullRequestReview entirely at GraphQL level while policy engine does body-level APPROVE-only blocking at REST level). The test should allow these documented asymmetries.",
        "file_path": "tests/unit/test_dual_layer_consistency.py",
        "acceptance_criteria": [
          "New file created at tests/unit/test_dual_layer_consistency.py",
          "BLOCKED_OPERATIONS dict covers all security-critical operations (merge, auto-merge enable/disable, review deletion)",
          "Each operation tested against both GitHubAPIFilter and PolicyEngine",
          "Both layers must block each operation for test to pass",
          "Documented asymmetries (GraphQL vs REST review blocking) are explicitly handled",
          "Adding a new blocked operation without implementing in both layers causes test failure"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:16:53.743821Z",
        "completed_at": "2026-02-08T22:21:54.654735Z",
        "actual_hours": 0.08
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-8": {
      "type": "task",
      "title": "Add red-team tests for self-merge prevention",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Add red-team tests to existing file (1239 lines, 22 test sections). These run inside the sandbox:\n\n- Attempt gh pr merge \u2192 expect 403\n- Attempt gh api -X PUT .../auto-merge \u2192 expect 403\n- Attempt gh pr review --approve \u2192 expect 403\n- Attempt gh pr review --comment -b \"looks good\" \u2192 expect success (verifies non-approval reviews still work via REST)\n- Attempt gh api -X DELETE .../pulls/.../reviews/123 \u2192 expect 403\n- Attempt GraphQL updatePullRequestBranch mutation \u2192 expect blocked",
        "file_path": "tests/redteam-sandbox.sh",
        "acceptance_criteria": [
          "gh pr merge test added, expects 403",
          "Auto-merge PUT test added, expects 403",
          "Review approve test added, expects 403",
          "Review comment test added, expects SUCCESS (non-approval reviews must work)",
          "Review deletion test added, expects 403",
          "GraphQL updatePullRequestBranch test added, expects blocked"
        ],
        "task_category": "implementation",
        "started_at": "2026-02-08T22:25:05.797521Z",
        "completed_at": "2026-02-08T22:26:30.707344Z",
        "needs_journaling": false,
        "actual_hours": 0.02,
        "journaled_at": "2026-02-08T22:26:30.707413Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Verify Phase 2: Self-merge prevention",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Run python -m pytest tests/unit/test_github_api_filter.py tests/unit/test_policy_engine.py tests/unit/test_dual_layer_consistency.py -v and verify all pass. Red-team tests pass inside sandbox.",
        "verification_type": "run-tests",
        "started_at": "2026-02-08T22:32:14.848186Z",
        "completed_at": "2026-02-08T22:32:31.717209Z",
        "needs_journaling": false,
        "actual_hours": 0.0,
        "journaled_at": "2026-02-08T22:32:31.717289Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Read-Only FS Restoration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "verify-3-1",
        "task-3-6"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Restore read_only: true in credential isolation mode by eliminating the root filesystem write requirement for CA certificate installation. Instead of running update-ca-certificates inside the sandbox (which requires writable root FS), generate a combined CA bundle (system CAs + mitmproxy CA) in the proxy container and share it via the existing mitm-certs volume. Mode detection uses explicit SANDBOX_CA_MODE=combined env var. Corresponds to PLAN1.md Item 4."
      },
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Generate combined CA bundle in proxy entrypoint",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "After copy_ca_to_shared_volume() (line 151), add a new function and call it:\n\n```bash\n# Generate combined CA bundle for sandbox containers.\n# Includes system CAs + mitmproxy CA so sandboxes don't need to run\n# update-ca-certificates (which requires a writable root filesystem).\ngenerate_combined_ca_bundle() {\n    local combined=\"${SHARED_CERTS_DIR}/ca-certificates.crt\"\n    local tmp=\"${combined}.tmp\"\n    # Write atomically: build in temp file, then rename.\n    # Prevents sandbox from reading a partial bundle (system CAs only,\n    # missing mitmproxy CA) if it starts between the two writes.\n    cat /etc/ssl/certs/ca-certificates.crt > \"$tmp\"\n    cat \"${MITMPROXY_CA_CERT}\" >> \"$tmp\"\n    mv \"$tmp\" \"$combined\"\n    log \"Combined CA bundle generated at $combined\"\n}\n```\n\nCall generate_combined_ca_bundle immediately after copy_ca_to_shared_volume. The proxy generates the bundle early in its entrypoint, before its health endpoint starts. The dev service uses depends_on: condition: service_healthy, so the sandbox only starts after the proxy's healthcheck passes \u2014 by which point the bundle already exists. No polling needed.",
        "file_path": "unified-proxy/entrypoint.sh",
        "acceptance_criteria": [
          "generate_combined_ca_bundle() function added to unified-proxy/entrypoint.sh",
          "Function called after copy_ca_to_shared_volume()",
          "Atomic write via tmp+mv pattern (prevents partial reads)",
          "Combined bundle includes system CAs + mitmproxy CA",
          "Bundle written to ${SHARED_CERTS_DIR}/ca-certificates.crt"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Update docker-compose.credential-isolation.yml",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Three changes:\n\n1. Remove the read_only: false override (line 157-164). The base compose already sets read_only: true, so removing the override restores it. Replace the comment block with:\n```yaml\n# Read-only filesystem is inherited from base compose (read_only: true).\n# /etc/hosts and /etc/resolv.conf are Docker bind mounts (writable regardless).\n# CA trust is handled via combined bundle in shared volume (no update-ca-certificates needed).\n```\n\n2. Add SANDBOX_CA_MODE=combined to environment variables:\n```yaml\nenvironment:\n  # Explicit mode signal: tells sandbox entrypoint to use combined CA bundle\n  # instead of running update-ca-certificates (which requires writable root FS)\n  - SANDBOX_CA_MODE=combined\n```\n\n3. Update CA environment variables to point at combined bundle:\n```yaml\n  - NODE_EXTRA_CA_CERTS=/certs/ca-certificates.crt\n  - REQUESTS_CA_BUNDLE=/certs/ca-certificates.crt\n  - SSL_CERT_FILE=/certs/ca-certificates.crt\n  - CURL_CA_BUNDLE=/certs/ca-certificates.crt\n  - GIT_SSL_CAINFO=/certs/ca-certificates.crt\n```\n\nAll CA env vars point at the combined bundle (system CAs + mitmproxy CA) to ensure every TLS library works regardless of whether it treats the variable as additive or replacement.",
        "file_path": "docker-compose.credential-isolation.yml",
        "acceptance_criteria": [
          "read_only: false override removed",
          "SANDBOX_CA_MODE=combined env var added",
          "NODE_EXTRA_CA_CERTS points to /certs/ca-certificates.crt",
          "REQUESTS_CA_BUNDLE points to /certs/ca-certificates.crt",
          "SSL_CERT_FILE points to /certs/ca-certificates.crt",
          "CURL_CA_BUNDLE points to /certs/ca-certificates.crt",
          "GIT_SSL_CAINFO points to /certs/ca-certificates.crt"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "Remove CA cert installation from entrypoint-root.sh",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Remove the CA cert installation block (lines 51-57). Keep DNS and iptables setup (they work with read-only FS because they modify kernel state or Docker bind mounts, not the root filesystem). The block to remove:\n\n```bash\nif [ -f \"/certs/mitmproxy-ca.pem\" ]; then\n    echo \"Adding mitmproxy CA to system trust store...\"\n    cp \"/certs/mitmproxy-ca.pem\" \"/usr/local/share/ca-certificates/mitmproxy-ca.crt\" 2>/dev/null || true\n    update-ca-certificates >/dev/null 2>&1 || true\nfi\n```\n\nThis block writes to /usr/local/share/ca-certificates/ which is on the root filesystem and fails with read_only: true. The combined CA bundle in the shared volume replaces this functionality.",
        "file_path": "entrypoint-root.sh",
        "acceptance_criteria": [
          "CA cert installation block removed from entrypoint-root.sh",
          "DNS setup (resolv.conf) preserved",
          "iptables setup preserved",
          "/etc/hosts setup preserved"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "Add conditional CA trust to sandbox entrypoint.sh",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Replace lines 257-277 (the CA cert fallback section) with conditional logic based on SANDBOX_CA_MODE:\n\n```bash\n# Trust mitmproxy CA when mounted (explicit proxy mode)\nif [ -f \"/certs/mitmproxy-ca.pem\" ]; then\n    echo \"Configuring CA trust for proxy...\"\n\n    if [ \"${SANDBOX_CA_MODE}\" = \"combined\" ]; then\n        # Combined bundle mode (credential-isolation with read-only FS).\n        # Env vars (NODE_EXTRA_CA_CERTS, REQUESTS_CA_BUNDLE, etc.) are set\n        # via docker-compose.credential-isolation.yml.\n        if [ ! -f \"/certs/ca-certificates.crt\" ]; then\n            echo \"FATAL: SANDBOX_CA_MODE=combined but /certs/ca-certificates.crt not found\"\n            echo \"The proxy container may not be running or failed to generate the combined bundle.\"\n            exit 1\n        fi\n        echo \"Combined CA bundle available at /certs/ca-certificates.crt\"\n\n        # Defensive: set CA env vars here as a safety net in case compose-level\n        # env vars are missing. These are no-ops if already set by compose.\n        export NODE_EXTRA_CA_CERTS=\"${NODE_EXTRA_CA_CERTS:-/certs/ca-certificates.crt}\"\n        export REQUESTS_CA_BUNDLE=\"${REQUESTS_CA_BUNDLE:-/certs/ca-certificates.crt}\"\n        export SSL_CERT_FILE=\"${SSL_CERT_FILE:-/certs/ca-certificates.crt}\"\n        export CURL_CA_BUNDLE=\"${CURL_CA_BUNDLE:-/certs/ca-certificates.crt}\"\n        export GIT_SSL_CAINFO=\"${GIT_SSL_CAINFO:-/certs/ca-certificates.crt}\"\n    else\n        # Legacy path: no combined bundle (standalone proxy or non-isolation mode).\n        export NODE_EXTRA_CA_CERTS=\"/certs/mitmproxy-ca.pem\"\n        export REQUESTS_CA_BUNDLE=\"/certs/mitmproxy-ca.pem\"\n        export SSL_CERT_FILE=\"/certs/mitmproxy-ca.pem\"\n        export CURL_CA_BUNDLE=\"/certs/mitmproxy-ca.pem\"\n        export GIT_SSL_CAINFO=\"/certs/mitmproxy-ca.pem\"\n        if command -v update-ca-certificates >/dev/null 2>&1; then\n            if [ \"$(id -u)\" = \"0\" ]; then\n                cp \"/certs/mitmproxy-ca.pem\" \"/usr/local/share/ca-certificates/mitmproxy-ca.crt\" 2>/dev/null || true\n                update-ca-certificates >/dev/null 2>&1 || true\n            elif command -v sudo >/dev/null 2>&1 && sudo -n true 2>/dev/null; then\n                sudo cp \"/certs/mitmproxy-ca.pem\" \"/usr/local/share/ca-certificates/mitmproxy-ca.crt\" 2>/dev/null || true\n                sudo update-ca-certificates >/dev/null 2>&1 || true\n            elif [ -w \"/usr/local/share/ca-certificates\" ]; then\n                cp \"/certs/mitmproxy-ca.pem\" \"/usr/local/share/ca-certificates/mitmproxy-ca.crt\" 2>/dev/null || true\n                update-ca-certificates >/dev/null 2>&1 || true\n            fi\n        fi\n    fi\nfi\n```\n\nBehavioral change in legacy path: adds GIT_SSL_CAINFO=/certs/mitmproxy-ca.pem which was not previously set. This is intentional \u2014 without it, git-over-HTTPS relies solely on system CA store update which can fail silently on non-root containers.\n\nStartup ordering: No polling loop needed. The proxy generates the combined bundle before its health endpoint starts. depends_on: condition: service_healthy ensures sandbox starts after proxy is ready.",
        "file_path": "entrypoint.sh",
        "acceptance_criteria": [
          "SANDBOX_CA_MODE=combined branch uses combined bundle at /certs/ca-certificates.crt",
          "SANDBOX_CA_MODE=combined branch exits fatally if bundle not found",
          "Defensive env var exports with :- defaults in combined mode",
          "Legacy path preserved for non-credential-isolation mode",
          "GIT_SSL_CAINFO added to legacy path (intentional improvement)",
          "Legacy path still attempts update-ca-certificates with root/sudo/writable fallbacks",
          "No polling loop (startup ordering handled by depends_on health check)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "Add red-team tests for read-only FS and CA trust",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add/modify red-team tests in existing file:\n\n- Verify filesystem is read-only: touch /usr/bin/test-file 2>&1 | grep -q \"Read-only\" \u2192 pass\n- Verify CA trust works: curl -s https://api.anthropic.com \u2192 succeeds (via proxy)\n- Verify git over HTTPS works: git ls-remote https://github.com/... \u2192 succeeds (via proxy)\n- Verify combined CA bundle exists: test -f /certs/ca-certificates.crt \u2192 pass\n- Verify SANDBOX_CA_MODE is set: [ \"$SANDBOX_CA_MODE\" = \"combined\" ] \u2192 pass\n- Verify tmpfs is writable: touch /tmp/test-file && rm /tmp/test-file \u2192 pass\n- Verify home is writable: touch ~/test-file && rm ~/test-file \u2192 pass",
        "file_path": "tests/redteam-sandbox.sh",
        "acceptance_criteria": [
          "Read-only FS test added",
          "CA trust (curl) test added",
          "Git HTTPS test added",
          "Combined bundle existence test added",
          "SANDBOX_CA_MODE test added",
          "tmpfs writable test added",
          "Home dir writable test added"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Verify Phase 3: Read-only FS restoration",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Create a new sandbox with credential isolation: ./sandbox.sh new owner/repo. Attach and verify:\n1. touch /usr/bin/xxx fails with 'Read-only file system'\n2. touch /tmp/xxx && rm /tmp/xxx succeeds (tmpfs still writable)\n3. touch ~/xxx && rm ~/xxx succeeds (home tmpfs still writable)\n4. curl https://api.anthropic.com works (credential injection + CA trust)\n5. git ls-remote works over HTTPS\n6. /certs/ca-certificates.crt exists\n7. $SANDBOX_CA_MODE = combined",
        "verification_type": "manual"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Workflow Push Blocking",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "task-4-5",
        "task-4-6",
        "task-4-7",
        "task-4-8",
        "task-4-9",
        "task-4-10",
        "verify-4-1",
        "task-4-11"
      ],
      "total_tasks": 12,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "",
        "description": "Block pushes that add or modify files under .github/workflows/ or .github/actions/, preventing indirect merge via GitHub Actions. The interception point is the git proxy addon (unified-proxy/addons/git_proxy.py), which intercepts HTTPS push traffic. Since the request() hook fires before the push is forwarded to GitHub, new objects exist only in the pack data, not yet in the bare repo. The approach: extract pack data from the request body (after pkt-line header), unpack into a temporary object store with the bare repo as an alternate, run git diff-tree to check changed files. Fail closed on any error. Highest complexity. Corresponds to PLAN1.md Item 2b."
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Add DEFAULT_RESTRICTED_PUSH_PATHS to git_policies.py",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add restricted paths as a configurable policy alongside existing DEFAULT_PROTECTED_PATTERNS:\n\n```python\nDEFAULT_RESTRICTED_PUSH_PATHS: List[str] = [\n    \".github/workflows\",\n    \".github/actions\",\n]\n```\n\nPaths are stored without trailing slashes. The check uses `line == path or line.startswith(path + \"/\")` to match both the directory itself and any files underneath it. As a defensive measure, _check_restricted_paths() normalizes paths with rstrip(\"/\") at runtime, so a misconfigured trailing slash won't cause silent bypasses.\n\n.github/actions/ is included because custom composite actions can also execute arbitrary code, including merge operations.",
        "file_path": "unified-proxy/git_policies.py",
        "acceptance_criteria": [
          "DEFAULT_RESTRICTED_PUSH_PATHS list added to git_policies.py",
          "Contains .github/workflows (no trailing slash)",
          "Contains .github/actions (no trailing slash)",
          "Type annotation List[str] included"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Set bare_repo_path in container metadata",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Set bare_repo_path in the container metadata during container registration. The bare repo path follows a predictable convention based on the repo owner/name:\n\n```python\nmetadata[\"bare_repo_path\"] = os.path.join(REPOS_BASE_DIR, owner, repo + \".git\")\n```\n\nWhere REPOS_BASE_DIR is the directory where the proxy stores bare repos (verify the actual path from the proxy's git clone/fetch logic).\n\nPer AI review feedback: if bare_repo_path is not available or invalid, write operations should fail-closed rather than silently skipping the restricted-paths check. The guard in the request() method should handle this (see integration task).",
        "file_path": "unified-proxy/addons/container_identity.py",
        "acceptance_criteria": [
          "bare_repo_path set in container metadata during registration",
          "Path derived from REPOS_BASE_DIR + owner + repo.git convention",
          "REPOS_BASE_DIR matches the actual bare repo storage location"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Add pack_data field to GitOperation dataclass",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add pack_data: bytes field to the GitOperation dataclass. In _parse_git_request(), after pkt-line parsing (line 284), extract the pack data. pktline_end is the byte offset returned by read_pktline_prefix() \u2014 it marks the end of the flush packet, so everything after it is pack data:\n\n```python\n# After line 284: refs = parse_pktline(buf[:pktline_end])\npack_data = body[pktline_end:] if pktline_end and pktline_end < len(body) else b\"\"\n```\n\nPass pack_data into the GitOperation constructor at line 288.\n\nThe read_pktline_prefix() function (pktline.py:138) already handles flush packet detection (0000), capabilities parsing, and max-bytes bounding. pktline_end is a reliable boundary marker.",
        "file_path": "unified-proxy/addons/git_proxy.py",
        "acceptance_criteria": [
          "pack_data: bytes field added to GitOperation dataclass",
          "Pack data extracted from request body after pktline_end offset",
          "Empty bytes returned when no pack data present",
          "pack_data passed to GitOperation constructor"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Add _make_clean_git_env() helper method",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add helper method to build a minimal environment for git subprocesses:\n\n```python\ndef _make_clean_git_env(self, **extra) -> dict:\n    \"\"\"Build a minimal environment for git subprocesses in restricted-path checks.\n\n    Uses only PATH (for finding the git binary) and HOME (required by git\n    for config resolution). All GIT_* and SSH_* vars from the proxy's own\n    environment are excluded to prevent interference (e.g., GIT_DIR,\n    GIT_WORK_TREE, GIT_CONFIG_PARAMETERS could confuse the subprocess).\n    \"\"\"\n    env = {\"PATH\": os.environ.get(\"PATH\", \"/usr/local/bin:/usr/bin:/bin\")}\n    home = os.environ.get(\"HOME\")\n    if home:\n        env[\"HOME\"] = home\n    env.update(extra)\n    return env\n```\n\nThis prevents: (a) environment variable confusion that could cause the subprocess to operate on the wrong repository, and (b) credential leakage via GIT_CREDENTIAL_TOKEN or similar vars.",
        "file_path": "unified-proxy/addons/git_proxy.py",
        "acceptance_criteria": [
          "_make_clean_git_env() method added to git proxy class",
          "Only PATH and HOME from host environment",
          "Accepts **extra kwargs for GIT_OBJECT_DIRECTORY etc.",
          "GIT_*, SSH_* vars from proxy environment excluded"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-5": {
      "type": "task",
      "title": "Implement _check_restricted_paths() method",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Implement the core restricted-paths check method. Full implementation in PLAN1.md Item 2b. Key aspects:\n\n1. Accept refs, bare_repo_path, pack_data, restricted_paths parameters\n2. Return None if allowed, generic error message if blocked\n3. Normalize restricted paths with rstrip(\"/\")\n4. Create temp dir with mkdtemp(prefix=\"git-restricted-check-\")\n5. Initialize temp bare repo with git init --bare\n6. Write alternates file pointing to real bare repo's objects dir\n7. Unpack pack data with git unpack-objects (10s timeout, clean env)\n8. For each non-deletion ref, run git diff-tree --name-only -r old new (10s timeout)\n9. For new branches (old_sha is all zeros), diff against GIT_EMPTY_TREE_SHA = \"4b825dc642cb6eb9a060e54bf899d69f82623700\"\n10. Check each changed file against restricted paths\n11. Log specific blocked path server-side at ctx.log.info level\n12. Return generic \"Push blocked by security policy\" (never reveal which path)\n13. Fail closed on any error (unpack failure, diff-tree failure, timeout)\n14. Always clean up temp dir in finally block\n\nSECURITY NOTES:\n- Pack data is untrusted (from sandbox). A memory-safety bug in git's pack parser could allow code execution on the proxy. Accepted risk with mitigations: size bounded by DEFAULT_MAX_PUSH_SIZE (100MB), 10s timeout, temp dir isolation, minimal env, fail-closed.\n- Thin packs handled via alternates (base objects in bare repo).\n- THREADING: This method is not thread-safe. It relies on mitmproxy's default synchronous addon execution (no @concurrent decorator). If concurrent execution is enabled, add a threading.Lock around the entire method.",
        "file_path": "unified-proxy/addons/git_proxy.py",
        "acceptance_criteria": [
          "Method accepts refs, bare_repo_path, pack_data, restricted_paths",
          "Returns None if allowed, generic error string if blocked",
          "Temp bare repo initialized with git init --bare",
          "Alternates file written to link temp objects with bare repo",
          "git unpack-objects runs with 10s timeout and clean env",
          "git diff-tree runs per non-deletion ref with 10s timeout",
          "New branches diff against GIT_EMPTY_TREE_SHA",
          "Changed files checked against restricted paths (exact match or prefix + /)",
          "Error message is generic: 'Push blocked by security policy'",
          "Specific blocked path logged server-side only",
          "Fail closed on any subprocess error or timeout",
          "Temp dir cleaned in finally block",
          "Concurrency assumption documented in code comment",
          "Restricted paths normalized with rstrip(/)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-6": {
      "type": "task",
      "title": "Integrate restricted-paths check in request() method",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Call _check_restricted_paths() in the request() method alongside existing write-operation checks (after protected-branch checks at line 204-220):\n\n```python\nif git_op.is_write:\n    # ... existing size checks, deletion checks, protected branch checks ...\n\n    # Check for restricted file paths (e.g., .github/workflows/)\n    bare_repo_path = metadata.get(\"bare_repo_path\")\n    if bare_repo_path and os.path.isdir(bare_repo_path) and git_op.pack_data:\n        restricted_msg = self._check_restricted_paths(\n            git_op.refs, bare_repo_path, git_op.pack_data,\n            git_policies.DEFAULT_RESTRICTED_PUSH_PATHS,\n        )\n        if restricted_msg:\n            self._deny_request(flow, restricted_msg)\n            return\n    elif git_op.pack_data and not bare_repo_path:\n        # bare_repo_path not configured \u2014 log warning but don't block\n        # This should not happen in production; indicates misconfiguration\n        ctx.log.warn(\"[restricted-path] check skipped: bare_repo_path not in metadata\")\n```\n\nPer AI review: consider making missing bare_repo_path fail-closed for write operations in production. The current implementation logs a warning. Document this as a configuration issue.",
        "file_path": "unified-proxy/addons/git_proxy.py",
        "acceptance_criteria": [
          "_check_restricted_paths() called after existing write-operation checks",
          "Guard checks bare_repo_path exists, is a directory, and pack_data present",
          "Uses git_policies.DEFAULT_RESTRICTED_PUSH_PATHS",
          "Denied requests use _deny_request() with generic message",
          "Missing bare_repo_path logs warning with [restricted-path] prefix",
          "Early return after denial"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-7": {
      "type": "task",
      "title": "Add concurrency assumption comment",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add code comment anchoring the concurrency assumption near _check_restricted_paths():\n\n```python\n# THREADING: This method is not thread-safe. It relies on mitmproxy's default\n# synchronous addon execution (no @concurrent decorator). If concurrent execution\n# is enabled, add a threading.Lock around the entire method.\n```\n\nThis assumption depends on mitmproxy's default execution model. A malicious agent cannot DoS the proxy by issuing parallel pushes; they would simply queue.",
        "file_path": "unified-proxy/addons/git_proxy.py",
        "acceptance_criteria": [
          "Threading assumption documented in code comment near _check_restricted_paths()",
          "Comment mentions @concurrent decorator and threading.Lock"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-8": {
      "type": "task",
      "title": "Add unit tests for restricted-paths check",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add tests to existing file (910 lines, pytest + unittest.mock):\n\n- test_blocked_push_workflow_file \u2014 push containing .github/workflows/ci.yml change is blocked\n- test_blocked_push_actions_file \u2014 push containing .github/actions/custom/action.yml change is blocked\n- test_allowed_push_normal_file \u2014 push containing only src/main.py change is allowed\n- test_blocked_push_new_branch_with_workflow \u2014 branch creation containing a workflow file is blocked\n- test_allowed_push_branch_deletion \u2014 branch deletion is not inspected (no files to check)\n- test_fail_closed_on_diff_error \u2014 if git diff-tree fails, push is blocked\n- test_fail_closed_on_unpack_error \u2014 if git unpack-objects fails, push is blocked\n- test_temp_dir_cleanup \u2014 temporary object store is cleaned up even on failure\n- test_error_message_is_generic \u2014 returned error message does not contain file paths or restricted path names",
        "file_path": "tests/unit/test_git_proxy.py",
        "acceptance_criteria": [
          "test_blocked_push_workflow_file passes",
          "test_blocked_push_actions_file passes",
          "test_allowed_push_normal_file passes",
          "test_blocked_push_new_branch_with_workflow passes",
          "test_allowed_push_branch_deletion passes",
          "test_fail_closed_on_diff_error passes",
          "test_fail_closed_on_unpack_error passes",
          "test_temp_dir_cleanup passes",
          "test_error_message_is_generic passes (no file paths in error message)"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-9": {
      "type": "task",
      "title": "Add red-team test for workflow push blocking",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add red-team test to existing file (run inside sandbox):\n\n- Create a commit adding .github/workflows/merge.yml with a workflow that would auto-merge, attempt git push \u2192 expect rejection with generic error message\n- Verify normal code push (src/main.py) still works after workflow push is blocked",
        "file_path": "tests/redteam-sandbox.sh",
        "acceptance_criteria": [
          "Test creates commit with .github/workflows/merge.yml",
          "git push is rejected",
          "Error message is generic (does not reveal restricted path)",
          "Normal code pushes still succeed"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-10": {
      "type": "task",
      "title": "Update docs/security/sandbox-threats.md with proxy attack surface",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Add a new 'Proxy-Side Attack Surface' section documenting the untrusted pack data risk and mitigations:\n\n- The proxy runs git unpack-objects on untrusted pack data from the sandbox\n- A memory-safety bug in git's pack parser could allow code execution on the proxy (most privileged component)\n- Mitigations: (1) pack bounded by DEFAULT_MAX_PUSH_SIZE (100MB), (2) 10-second subprocess timeout, (3) isolated temp directory, (4) minimal subprocess environment, (5) fail-closed on any error\n- Accepted risk rationale: pure Python pack parser would be equally complex and untested against adversarial input\n- Reference to DEFAULT_RESTRICTED_PUSH_PATHS configuration",
        "file_path": "docs/security/sandbox-threats.md",
        "acceptance_criteria": [
          "New Proxy-Side Attack Surface section added to sandbox-threats.md",
          "Untrusted pack data risk documented",
          "All five mitigations listed",
          "Accepted risk rationale included",
          "References to relevant code and configuration"
        ],
        "task_category": "implementation"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Verify Phase 4: Workflow push blocking",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run python -m pytest tests/unit/test_git_proxy.py -v and verify all pass. Red-team workflow push test passes inside sandbox. Normal code pushes still work.",
        "verification_type": "run-tests"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-6": {
      "type": "task",
      "title": "Fidelity review: Git hook hardening",
      "status": "completed",
      "parent": "phase-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Run foundry-review to compare Phase 1 implementation against spec requirements. Verify that: (1) execute_git() injects both -c flags before translated_args, (2) CONFIG_NEVER_ALLOW blocks client overrides, (3) all unit and security tests match spec acceptance criteria, (4) no unintended side effects on existing git operations.",
        "verification_type": "fidelity",
        "started_at": "2026-02-08T22:09:09.741211Z",
        "completed_at": "2026-02-08T22:12:11.765312Z",
        "needs_journaling": false,
        "actual_hours": 0.05,
        "journaled_at": "2026-02-08T22:12:11.765387Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-9": {
      "type": "task",
      "title": "Fidelity review: Self-merge prevention API hardening",
      "status": "completed",
      "parent": "phase-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "description": "Run foundry-review to compare Phase 2 implementation against spec requirements. Verify that: (1) all REST and GraphQL blocks are present in both github-api-filter.py and policy_engine.py, (2) cross-reference comments exist in both files, (3) body inspection blocks only APPROVE events (COMMENT and REQUEST_CHANGES allowed), (4) dual-layer consistency test covers all blocked operations with explicit asymmetry handling, (5) new test files use existing conftest.py infrastructure correctly, (6) red-team tests cover all specified vectors.",
        "verification_type": "fidelity",
        "started_at": "2026-02-08T22:26:41.524963Z",
        "completed_at": "2026-02-08T22:32:06.072659Z",
        "needs_journaling": false,
        "actual_hours": 0.09,
        "journaled_at": "2026-02-08T22:32:06.072729Z"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-6": {
      "type": "task",
      "title": "Fidelity review: Read-only FS restoration",
      "status": "pending",
      "parent": "phase-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to compare Phase 3 implementation against spec requirements. Verify that: (1) combined CA bundle uses atomic write (tmp+mv), (2) read_only: false override removed from credential-isolation compose, (3) SANDBOX_CA_MODE=combined env var set, (4) all five CA env vars point to combined bundle, (5) entrypoint.sh conditional logic correctly branches on SANDBOX_CA_MODE, (6) legacy path preserved with GIT_SSL_CAINFO addition, (7) fatal exit if combined bundle missing in combined mode, (8) entrypoint-root.sh CA block removed but DNS/iptables preserved.",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-11": {
      "type": "task",
      "title": "Fidelity review: Workflow push blocking",
      "status": "pending",
      "parent": "phase-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Run foundry-review to compare Phase 4 implementation against spec requirements. Verify that: (1) DEFAULT_RESTRICTED_PUSH_PATHS contains both .github/workflows and .github/actions without trailing slashes, (2) bare_repo_path set in container metadata with correct derivation, (3) pack_data extracted correctly using pktline_end boundary, (4) _make_clean_git_env() excludes all GIT_*/SSH_* vars, (5) _check_restricted_paths() implements all 14 acceptance criteria (temp repo init, alternates, unpack, diff-tree, empty tree SHA, generic errors, fail-closed, cleanup, concurrency comment, path normalization), (6) request() integration guards on bare_repo_path existence, (7) unit tests cover all 9 specified scenarios, (8) sandbox-threats.md updated with proxy attack surface section.",
        "verification_type": "fidelity"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  },
  "journal": [
    {
      "timestamp": "2026-02-08T22:05:34.619175Z",
      "entry_type": "status_change",
      "title": "Task Completed: Inject hook-disabling flags in execute_git()",
      "content": "Injected -c core.hooksPath=/dev/null and -c core.fsmonitor=false into execute_git() command array at line 1806, before translated_args. The async variant (execute_git_async) delegates to execute_git so it's automatically covered. Both config keys are already in CONFIG_NEVER_ALLOW (lines 338-339) preventing client override. Basic verification: syntax correct, no imports needed. Full testing deferred to verify-1-1.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-1"
    },
    {
      "timestamp": "2026-02-08T22:08:36.515312Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add unit test test_proxy_side_hooks_disabled",
      "content": "Added test_proxy_side_hooks_disabled in TestProxySideHookFlags class. Verifies execute_git() injects -c core.hooksPath=/dev/null and -c core.fsmonitor=false into the subprocess command. Test passes. Full suite 144/144 passed.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2026-02-08T22:08:36.576437Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add unit test test_client_cannot_override_hooks_path",
      "content": "Added test_client_cannot_override_hooks_path in TestProxySideHookFlags. Tests both -c form (blocked via CONFIG_NEVER_ALLOW with 'blocked config key') and --config form (rejected via command allowlist). Test passes.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-3"
    },
    {
      "timestamp": "2026-02-08T22:08:36.632445Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add unit test test_client_cannot_override_fsmonitor",
      "content": "Added test_client_cannot_override_fsmonitor in TestProxySideHookFlags. Verifies -c core.fsmonitor=/tmp/evil is rejected by CONFIG_NEVER_ALLOW validation. Test passes.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-4"
    },
    {
      "timestamp": "2026-02-08T22:08:36.687463Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add security test test_hooks_disabled_in_execution",
      "content": "Added TestGitHookHardening class with test_hooks_disabled_in_execution in tests/security/test_git_policy.py. Verifies execute_git() subprocess command includes core.hooksPath=/dev/null and core.fsmonitor=false. Added tempfile and patch imports. Test passes. Full suite 22/22 passed.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-5"
    },
    {
      "timestamp": "2026-02-08T22:09:03.377842Z",
      "entry_type": "status_change",
      "title": "Task Completed: Verify Phase 1: Git hook hardening",
      "content": "All 166 tests pass (144 unit + 22 security). New tests: test_proxy_side_hooks_disabled, test_client_cannot_override_hooks_path, test_client_cannot_override_fsmonitor (unit), test_hooks_disabled_in_execution (security). No regressions.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "verify-1-1"
    },
    {
      "timestamp": "2026-02-08T22:12:11.765387Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fidelity review: Git hook hardening",
      "content": "Fidelity review passed with strong consensus (codex + claude both voted pass). One low-severity deviation: security test uses mock/command-inspection rather than end-to-end hook execution test. Recommendation: optionally add integration test as defense-in-depth. Review saved to specs/.fidelity-reviews/.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-1-6"
    },
    {
      "timestamp": "2026-02-08T22:15:33.473970Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add REST blocks to github-api-filter.py BLOCKED_PATTERNS",
      "content": "Added 3 REST block patterns to BLOCKED_PATTERNS: PUT auto-merge, DELETE auto-merge, DELETE review. Cross-reference comment to policy_engine.py included. PR review POST intentionally NOT blocked at path level. Syntax verified.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-1"
    },
    {
      "timestamp": "2026-02-08T22:15:33.543729Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add GraphQL mutations to ALWAYS_BLOCKED_GRAPHQL_MUTATIONS",
      "content": "Added 5 new entries to ALWAYS_BLOCKED_GRAPHQL_MUTATIONS: enablePullRequestAutoMerge, disablePullRequestAutoMerge, dismissPullRequestReview, updatePullRequestBranch, addPullRequestReview. Moved addPullRequestReview from CONDITIONAL to ALWAYS list with rationale comment. Syntax verified.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-2"
    },
    {
      "timestamp": "2026-02-08T22:15:33.637655Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add auto-merge and review deletion patterns to policy_engine.py",
      "content": "Added GITHUB_AUTO_MERGE_PATTERN and GITHUB_DELETE_REVIEW_PATTERN regex constants. Added blocking logic in _check_github_blocklist() for PUT/DELETE auto-merge and DELETE review. Cross-reference comments to github-api-filter.py included.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-3"
    },
    {
      "timestamp": "2026-02-08T22:15:33.698029Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add body inspection for PR review approval in policy_engine.py",
      "content": "Added GITHUB_PR_REVIEW_PATTERN regex. Extended _check_github_body_policies() to handle POST requests. Added PR review approval body inspection: only APPROVE is blocked via str(event).upper() comparison. COMMENT and REQUEST_CHANGES remain allowed. Method check is POST. Docstring updated.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-4"
    },
    {
      "timestamp": "2026-02-08T22:21:54.654756Z",
      "entry_type": "status_change",
      "title": "Completed: Create tests/unit/test_github_api_filter.py",
      "content": "Created tests/unit/test_github_api_filter.py (18 tests, all passing). 10 required tests: 4 REST blocking tests (merge, auto-merge PUT/DELETE, review deletion) and 6 GraphQL mutation blocking tests. Plus 8 additional coverage tests. Uses importlib for hyphenated module name, conftest.py mock infrastructure.",
      "author": "claude-code",
      "metadata": {},
      "task_id": "task-2-5"
    },
    {
      "timestamp": "2026-02-08T22:21:54.654805Z",
      "entry_type": "status_change",
      "title": "Completed: Add policy engine unit tests for new blocks",
      "content": "Added 6 new tests to tests/unit/test_policy_engine.py. 3 in TestCheckGithubBlocklist (auto_merge_enable, auto_merge_disable, review_deletion). New TestPRReviewBodyPolicies class (blocked_pr_review_approve, allowed_pr_review_comment, allowed_pr_review_request_changes). Fixed pre-existing test_pull_review_path_allowed failure. All 111 tests passing.",
      "author": "claude-code",
      "metadata": {},
      "task_id": "task-2-6"
    },
    {
      "timestamp": "2026-02-08T22:21:54.654833Z",
      "entry_type": "status_change",
      "title": "Completed: Create tests/unit/test_dual_layer_consistency.py",
      "content": "Created tests/unit/test_dual_layer_consistency.py (32 tests, all passing). BLOCKED_OPERATIONS dict covers 4 critical operations tested against both layers. KNOWN_ASYMMETRIES documents GraphQL vs REST review blocking. 7 test classes covering consistency, asymmetries, pattern coverage, completeness, isolation, and defense-in-depth.",
      "author": "claude-code",
      "metadata": {},
      "task_id": "task-2-7"
    },
    {
      "timestamp": "2026-02-08T22:26:30.707413Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add red-team tests for self-merge prevention",
      "content": "Added section 23 (SELF-MERGE PREVENTION) to tests/redteam-sandbox.sh with 6 red-team tests: (1) PR merge PUT block expects blocked, (2) auto-merge PUT expects blocked, (3) review approval POST with event=APPROVE expects blocked, (4) review comment POST with event=COMMENT expects success (non-approval reviews must work), (5) review deletion DELETE expects blocked, (6) GraphQL updatePullRequestBranch mutation expects blocked. All tests follow existing patterns (curl + grep response checking). Bash syntax check passes. Full test execution deferred to verify-2-1.",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-8"
    },
    {
      "timestamp": "2026-02-08T22:32:06.072729Z",
      "entry_type": "status_change",
      "title": "Task Completed: Fidelity review: Self-merge prevention API hardening",
      "content": "Fidelity review completed for Phase 2 (Self-Merge Prevention API Hardening). Verdict: partial (3 low-severity deviations, all justified). Deviations: (1) GraphQL addPullRequestReview blocks all events not just APPROVE \u2014 intentional fail-closed design since GraphQL lacks body inspection. (2) Unit tests use self-contained mocks rather than conftest \u2014 functionally equivalent. (3) Dual-layer consistency test uses flatter structure than spec example \u2014 same enforcement goal. Recommendations: run verify-2-1 with pytest/CI logs, run red-team tests in sandbox, document fail-closed GraphQL limitation. Review saved to specs/.fidelity-reviews/.\"",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "task-2-9"
    },
    {
      "timestamp": "2026-02-08T22:32:31.717289Z",
      "entry_type": "status_change",
      "title": "Task Completed: Verify Phase 2: Self-merge prevention",
      "content": "Phase 2 verification PASSED. Ran python -m pytest tests/unit/test_github_api_filter.py tests/unit/test_policy_engine.py tests/unit/test_dual_layer_consistency.py -v \u2014 161 tests passed in 0.50s. Breakdown: test_github_api_filter.py (18 tests: REST blocks, GraphQL blocks, edge cases), test_policy_engine.py (111 tests: blocklist, body policies, path enforcement, normalization, defense-in-depth), test_dual_layer_consistency.py (32 tests: dual-layer consistency, known asymmetries, pattern coverage, completeness, isolation, defense-in-depth). Red-team tests (section 23 of redteam-sandbox.sh) require sandbox environment \u2014 syntax validated via bash -n.\"",
      "author": "foundry-mcp",
      "metadata": {},
      "task_id": "verify-2-1"
    }
  ]
}